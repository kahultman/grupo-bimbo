---
title: "Baseline Model"
author: "Keith Hultman"
date: "June 12, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

```{r}
setwd("/Volumes/Half_Dome/datasets/grupo-bimbo/")
load("train2.Rdata")
load("validate.Rdata")

validate$sales_units <- NULL
validate$sales <- NULL
validate$returns <- NULL
validate$returns_units <- NULL

```

# Persistant Baseline Model

This model assumes that the previous week's demand will persist to the following two weeks. If a product or store id is not found in the training data, then the model will predict that the demand will be the overall average demand.

```{r}
train_last_week <- train2 %>% 
  filter(week >= 7) %>% 
  transmute(client, product, prediction = demand)

validate <- left_join(validate, train_last_week, by = c("client", "product"))
validate$prediction[is.na(validate$prediction)] <- mean(train2$demand)

# save(validate, file = "baseline_predictions.Rdata")


```

## Evaluation

We are using the Root Mean Squared Logarithmic Error, or RMSLE. 

$$\epsilon = \sqrt{\frac{1}{n} \sum_{i=1}^{n} \big(log(p_i + 1)-log(a_i + 1)\big)^2}$$

Where:

$\epsilon$ is the RMSLE value (score)

$n$ is the total number of observations in the data set,

$p_i$ is the prediction of demand

$a_i$ is the actual demand for $i$

$log(x)$ is the natural logarithm of $x$


```{r RMSLE}

sqerror <- (log(validate$prediction + 1) - log(validate$demand + 1))^2
epsilon <- sqrt(sum(sqerror) / length(sqerror))

epsilon
  

```

